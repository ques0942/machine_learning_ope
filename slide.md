# 機械学習の安定運用
---
# アプリの運用で重要なこと
* 人手がなくても安定して稼働すること
* データが破壊されないこと
    * 特定の状態に切り戻せること
    * 正しい状態が一意に決まること
    * 壊れた時に担保する線を決めること

長期運用ではコストをかけないことが最重要
---
# 前提
* 機械学習を長期間(一か月以上)稼働させる
    * 一か月くらいなら人力でもフォローできる
        * コスト的には多分ペイしない
---
# 人手がなくても安定して稼働すること
--
## 学習結果は経年劣化する
* 利用者は時間とともに変化する
    * 入力値も時間とともに傾向が変わる
    * リリース時点の学習データが正しく現在の入力値を説明できるとは限らない
したがって定期的な再学習が必要になる
--
## 自動で再学習するには
* 学習データの自動収集
    * ラベリング、クレンジングも含む
* 学習処理のバッチ実行
    * 結果の評価と適用
--
## モデルはアプリケーションから隔離すべき
* モデルのリリース頻度とアプリのリリース頻度はおそらく異なる
    * 画像などのアセット管理に近いはず
    * リリースでアプリの再起動が要求されると運用負荷が上がる

---
# データが破壊されないこと
* 復旧できないトラブルが一番の問題
    * 誤った定義に基づいてデータが更新されてしまった
        * 過去に遡って修正できるならよい
        * できないならあきらめる or 利用者に直接直してもらう
* 機械学習でのデータ破壊
    * モデルが変な学習した状態(過学習etc)になる
--
## 特定の状態に切り戻せること
* モデルのバックアップがあるならそれに戻せばよい
* ない場合は再度モデルを作り直し
    * この場合はモデルを作り直せるだけの学習データもバックアップがいる

--
## 正しい状態が一意に決まること
* 再現できないバグほどつらいものはない
    * 事故が起きることは大前提
    * 壊れた時になぜそれが起きたかわかるようにする
    * わからないものについては保証しない
        * 保証したいものについては検証しておく
--
## 壊れた時に担保する線を決めること
* 最低限守るべき線を決める
    * ルールベースで最低限のフィルタリング
        * レコメンドなら同じ候補を再度出さないようにする
        * ボットなら差別用語をしゃべらないようにする
        * etc

---
# まとめ
* モデルは自動で更新される体制が必要
* リリースサイクルに合わせたデプロイ方法が必要
* 学習データの期間は運用要件も含めて決める
* 最低限守るべきラインを決める

---
# 参考文献
[機械学習プロジェクトを頑健にする施策](https://speakerdeck.com/takahiko03/ji-jie-xue-xi-puroziekutowowan-jian-nisurushi-ce-ml-ops-study-number-2)
https://qiita.com/piyo7/items/59068fed6fb3e4b53174
